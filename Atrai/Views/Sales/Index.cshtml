@*@model IEnumerable<Atrai.Model.Core.Entity.SalesModel>*@
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@{
    ViewData["Title"] = "Sales List";
    Layout = "~/Views/Shared/_adminLayout.cshtml";
}

<link href="~/admin_theme_gtr/assets/css/customcardsdesign.css" rel="stylesheet" />
<link href="~/css/accountHeadListGearDropdown.css" rel="stylesheet" />

<style>

 /*   hr.solid {
        border-top: 2px solid #bbb;
        margin-top: .2rem;
        margin-bottom: .2rem;
        vertical-align: middle;
    }

    .dropdownplacement {
        transform: translate3d(-2px, 30px, 0px);
    }

    .dropdown-divider {
        margin: .0rem 0 !important;
    }*/
    .custom-grid{
        display: grid;
        grid-template-columns: repeat(3, 180px);
        grid-auto-flow: row;
    }
    .jsgrid-grid-body {
        overflow: auto;
    }
    .dropdown-divider {
        margin:0;
    }
    .dropdown-item {
        margin:0;
    }
</style>



<div class="card">
    @Html.Hidden("FromDate", null, new { @class = "form-control text-center FromDate", @placeholder = "From Date", @autocomplete = "off", name = "FromDate" })
    @Html.Hidden("ToDate", null, new { @class = "form-control text-center ToDate", @placeholder = "To Date", @autocomplete = "off", name = "ToDate" })

    <div class="card-body">
        <div class="row my-4">
            <div class="col-md-6">
                <h3>Sales List</h3>
            </div>
            <div class="col-md-3 col-12 divHiddenItems text-end">
                <label class="pr-2"><input type="radio" name="RptType" value="PDF" checked="checked" /> PDF  </label>
                <label class="pr-2"><input type="radio" name="RptType" value="EXCEL" /> EXCEL  </label>
                <label class="pr-2"><input type="radio" name="RptType" value="WORD" /> WORD  </label>

            </div>
            <div class="col-md-2 pt-2 text-end">
                <label>
                    Show All Column
                    <input type="checkbox" id="myCheck2">
                </label>
            </div>
            <div class="col-md-1 text-end">
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        new
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            @Html.ActionLink("New Sales", "AddSaleBySerialSearch", null, null, new { @class = "dropdown-item", @id = "btnsale" })
                        </li>
                        <li>
                            @Html.ActionLink("New Whole Sales", "AddWholeSale", null, null, new { @class = "dropdown-item", @id = "btnwholesale" })

                        </li>
                        <li class="divHiddenItems">
                            <button class="dropdown-item" type="button" onclick="ReportPrint('PrintSalesListWithItem')">Sales Details List</button>
                        </li>


                    </ul>
                </div>
            </div>
        </div>

        <div class=" p-2 mb-2">
            <div class="row">
                <div class="col-md-3 col-12">
                    <div class="mb-2">
                        <label class="form-label fw-semibold">
                            Select Customers
                        </label>
                        @Html.DropDownList("Customers", ViewBag.Customers as List<SelectListItem>, "Select Customers", new { id = "CustomerId", @class = "form-select" })
                    </div>
                </div>
                <div class="col-md-3 col-12">
                    <div class="mb-2">
                        <label class="form-label fw-semibold">
                            User
                        </label>
                        @Html.DropDownList("Users", ViewBag.Users as List<SelectListItem>, "Select Sales User", new { id = "UserId", @class = "form-select" })
                    </div>
                </div>

                <div class="col-md-3 col-12">
                    <div class="mb-2">
                        <label class="form-label fw-semibold">
                            Warehouse
                        </label>
                        @Html.DropDownList("Warehouse", ViewBag.Warehouse as List<SelectListItem>,  new { id = "WarehouseId", @class = "form-select" })
                    </div>
                </div>


                <div class="col-md-3 col-12">
                    <div class="mb-2">
                        <label class="form-label fw-semibold">
                            Status
                        </label>
                        @Html.DropDownList("Status", new List<SelectListItem>
                        {
                        new SelectListItem() {Text = "Due", Value="Due"},
                        new SelectListItem() {Text = "Date Wise Due", Value="Date Wise Due"},
                        new SelectListItem() {Text = "Cash Discount", Value="Cash Discount"},
                        new SelectListItem() {Text = "Date Wise Cash Discount", Value="Date Wise Discount"},
                        new SelectListItem() {Text = "Missing Head", Value="Missing Head"},
                        new SelectListItem() {Text = "All Sales", Value="All"},
                        }, new { @class = "form-select" })
                    </div>
                </div>

     
                <div class="col-md-4 col-12">
                    <div class="mb-2 divHiddenItems">
                        <label class="form-label fw-semibold">
                            Date
                        </label>

                        <div class="input-group">
                            <input type="text" class="form-control" name="date" id="daterange-btn">
                            <button id='btnDec' type="button" class="btn btn-danger " title='Decrement month'><i class="bi bi-calendar-minus" aria-hidden="true"></i></button>
                            <button id='btnInc' type="button" class="btn btn-success  " title='Increment month'><i class="bi bi-calendar-plus" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>


                <div class="col-md-4 col-12">
                    <div class="mb-2">
                        <label class="form-label fw-semibold">
                            Category
                        </label>
                        @Html.DropDownList("Category", ViewBag.Warehouse as List<SelectListItem>, "Select Category", new { id = "CategoryId", @class = "form-select" })
                    </div>
                </div>
                <div class="col-md-4 col-12">
                    <div class="mb-2">
                        <label class="form-label fw-semibold">
                            Type
                        </label>
                        @Html.DropDownList("DocType", ViewBag.DocType as List<SelectListItem>, "Select Type", new { id = "DocTypeId", @class = "form-select" })
                    </div>
                </div>

            </div>
        </div>

<!-- Gear Icon configuration for jsgrid Start -->

<div>

            <div class="dropdown1 mt-3 custom-grid" style="display:inline-block;">
                <button class="btn btn-white border-0" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown"
                        aria-expanded="false">
                    <i class="bi bi-gear" me-1"></i>
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                    <div class="row p-4 main-dropdown-size" style="overflow:hidden;">
                        <div class="col">
                    <span class="fw-bold ms-3">Columns</span>
                    <hr class="m-0 w-75 ms-3 w-sm-50 " />
                    <ul class="list-unstyled">
                    <li>
                        <div id="dropdown-titles" class="custom-grid"> 
                        </div>
                    </li>
                    </ul>
                    </div>

            <div class="col mt-3 vertical-hr">
                <span class="fw-bold mt-5 ms-3">Others</span>
                <hr class="m-0 w-75 w-sm-50  ms-3" />
                    <ul class="list-unstyled">
                <li><a id="show-all" value="100" class="dropdown-item" href="#">Show all</a></li>
                <li><a id="hide-all" class="dropdown-item" href="#">Hide all</a></li>
                <li><a id="restore" class="dropdown-item" href="#">Restore</a></li>


                <li>
                    <select name="rows" id="rows" class="border-0 cursor-pointer" style="margin-left: 13px;padding: 10px 0;width: 70px; ">
                                    @*<option value="0" class="w-100">Rows</option>*@
                        <option value="0" disabled selected>Rows</option>
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="1000">1000</option>
                    </select>
                </li>
                <li>
                    <a class="dropdown-item" href="#">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input title-input" id="withChild" value="withChild">
                            <label class="custom-control-label cursor-pointer" id="withChild-label" for="withChild">Export with Child</label>
                        </div>
                    </a>
                </li>
                </ul>
            </div>
        </div>
        </div>


</div>
  

            <div class="btn-group">
            <button class="btn btn-sm border border-end-0" type="button" id="exportUl">
                <img src="~/assets/excel 1.png" alt="">
            </button>
            <button type="button" class="btn border border-start-0 dropdown-toggle dropdown-toggle-split" id="exportBtn" data-bs-toggle="dropdown" data-target="#exportUl" aria-expanded="false">
                <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu" id="exportPDF">
                <li><a class="dropdown-item" href="#"><img src="~/assets/pdf 1.png" alt="">PDF</a></li>
            </ul>
            </div>
            </div>
            
<!-- Gear Icon configuration for jsgrid End -->



<div class="gridSection">
    <div class="row mt-2">
        <div class="col-12 col-md-12">
            <div id="jsGridItems"></div>
        </div>
    </div>
</div>


<div class="p-2 mb-2 animated slideInRight">
    <div class="row">
        <div class="col-md-3 col-12" id="divfullinfoone">
            <div class="cards">
                <div class="card-d card-1">
                    <div class="card__icon"><i class="bi bi-lightning"></i></div>

                    <h5 class="card__exit">User Wise Sales</h5>
                    <p class="card__apply">
                        <a class="card__link" href="javascript:void(0);" id="fullinfoone"><i class="fas fa-arrow-right"></i></a>

                    </p>
                </div>
            </div>
        </div>
                @*<div id="divfullinfoone" class="card-dashboard P-15 mt-3" style="background:antiquewhite">
        <div class="media">
        <div class="media-left meida media-middle">
        <span><i class="fa fa-user fontshadow f-s-40 color-success"></i></span>
        </div>
        <div class="media-body media-text-right">
        <h5>User Wise Sales</h5>
        </div>
        </div>
        <div class="text-right">
        <p id="fullinfoone" class="m-b-0"></p>
        </div>
        </div>*@
        <div class="col-md-3 col-12" id="divfullinfofour">
            <div class="cards">
                <div class="card-d card-2">
                    <div class="card__icon"><i class="bi bi-lightning"></i></div>

                    <h5 class="card__exit">User Wise Commission</h5>
                    <p class="card__apply">
                        <a class="card__link" href="javascript:void(0);" id="fullinfofour"><i class="fas fa-arrow-right"></i></a>

                    </p>
                </div>
            </div>
                    @*                <div id="divfullinfofour" class="card-dashboard P-15 mt-3" style="background:lavender">
            <div class="media">
            <div class="media-left meida media-middle">
            <span><i class="bi bi-collection fontshadow f-s-40 color-primary"></i></span>
            </div>
            <div class="media-body media-text-right">
            <h5>User Wise Commission</h5>

            </div>
            </div>
            <div class="text-right">
            <p id="fullinfofour" class="m-b-0"></p>
            </div>
            </div>*@
        </div>
        <div class="col-md-3 col-12" id="divfullinfoeight">
            <div class="cards">
                <div class="card-d card-3">
                    <div class="card__icon"><i class="bi bi-lightning"></i></div>

                    <h5 class="card__exit">Post / Unpost Sales</h5>
                    <p class="card__apply">
                        <a class="card__link" href="javascript:void(0);" id="fullinfoeight"><i class="fas fa-arrow-right"></i></a>

                    </p>
                </div>
            </div>
                    @* <div id="divfullinfoeight" class="card-dashboard P-15 mt-3" style="background:aliceblue">
            <div class="media">
            <div class="media-left meida media-middle">
            <span><i class="bi bi-files fontshadow f-s-40 font-color-7"></i></span>
            </div>
            <div class="media-body media-text-right">
            <h5>Post / Unpost Sales</h5>
            </div>
            </div>
            <div class="text-right">
            <p id="fullinfoeight" class="m-b-0"></p>
            </div>
            </div>*@

        </div>
        <div class="col-md-3 col-12" id="divfullinfotwo">
            <div class="cards">
                <div class="card-d card-4">
                    <div class="card__icon"><i class="bi bi-lightning"></i></div>

                    <h5 class="card__exit">Date Wise Sales</h5>
                    <p class="card__apply">
                        <a class="card__link" href="javascript:void(0);" id="fullinfotwo"><i class="fas fa-arrow-right"></i></a>

                    </p>
                </div>
            </div>
        </div>
                @*              <div id="divfullinfotwo" class="card-dashboard P-15 mt-3" style="background:beige">
        <div class="media">
        <div class="media-left meida media-middle">
        <span><i class="bi bi-calendar fontshadow f-s-40 color-info"></i></span>
        </div>
        <div class="media-body media-text-right">
        <h5>Date Wise Sales</h5>
        </div>
        </div>
        <div class="text-right">
        <p id="fullinfotwo" class="m-b-0"></p>
        </div>
        </div>*@
        <div class="col-md-3 col-12 my-3" id="divfullinfonine">
            <div class="cards">
                <div class="card-d card-5">
                    <div class="card__icon"><i class="bi bi-lightning"></i></div>

                    <h5 class="card__exit">Top Selling Category</h5>
                    <p class="card__apply">
                        <a class="card__link" href="javascript:void(0);" id="fullinfonine"><i class="fas fa-arrow-right"></i></a>

                    </p>
                </div>
            </div>
                    @*                 <div id="divfullinfonine" class="card-dashboard P-15 mt-3" style="background:ivory">
            <div class="media">
            <div class="media-left meida media-middle">
            <span><i class="fa fa-cubes fontshadow f-s-40 color-primary"></i></span>
            </div>
            <div class="media-body media-text-right">
            <h5>Top Selling Category</h5>

            </div>
            </div>
            <div class="text-right">
            <p id="fullinfonine" class="m-b-0"></p>
            </div>
            </div>*@

        </div>
        <div class="col-md-3 col-12 my-3" id="divfullinfothree">
            <div class="cards">
                <div class="card-d card-1">
                    <div class="card__icon"><i class="bi bi-lightning"></i></div>

                    <h5 class="card__exit">Receive By Head</h5>
                    <p class="card__apply">
                        <a class="card__link" href="javascript:void(0);" id="fullinfothree"><i class="fas fa-arrow-right"></i></a>

                    </p>
                </div>
            </div>

                    @* <div class="card-dashboard P-15 mt-3" style="background:seashell">
            <div class="media">
            <div class="media-left meida media-middle">
            <span><i class="fa fa-sitemap fontshadow f-s-40 color-warning"></i></span>
            </div>
            <div class="media-body media-text-right">
            <h5>Receive By Head</h5>

            </div>
            </div>
            <div class="text-right">
            <p id="fullinfothree" class="m-b-0"></p>
            </div>
            </div>*@
        </div>
        <div class="col-md-3 col-12 my-3" id="divfullinfoseven">
            <div class="cards">
                <div class="card-d card-2">
                    <div class="card__icon"><i class="bi bi-lightning"></i></div>
                    <h5 class="card__exit">Top Selling Customer</h5>
                    <p class="card__apply">
                        <a class="card__link" href="javascript:void(0);" id="fullinfoseven"><i class="fas fa-arrow-right"></i></a>
                    </p>
                </div>
            </div>
                    @*                 <div id="divfullinfoseven" class="card-dashboard P-15 mt-3" style="background:honeydew">
            <div class="media">
            <div class="media-left meida media-middle">
            <span><i class="fa fa-users fontshadow f-s-40 color-info"></i></span>
            </div>
            <div class="media-body media-text-right">
            <h5>Top Selling Customer</h5>
            </div>
            </div>
            <div class="text-right">
            <p id="fullinfoseven" class="m-b-0"></p>
            </div>
            </div>*@
        </div>
        <div class="col-md-3 col-12 my-3" id="divfullinfosix">
            <div class="cards">
                <div class="card-d card-3">
                    <div class="card__icon"><i class="bi bi-lightning"></i></div>
                    <h5 class="card__exit">Top Due Customer</h5>
                    <p class="card__apply">
                        <a class="card__link" href="javascript:void(0);" id="fullinfosix"><i class="fas fa-arrow-right"></i></a>
                    </p>
                </div>
            </div>
                    @*
            <div id="divfullinfosix" class="card-dashboard P-15 mt-3" style="background:ivory">
            <div class="media">
            <div class="media-left meida media-middle">
            <span><i class="fa fa-usd fontshadow f-s-40 color-danger"></i></span>
            </div>
            <div class="media-body media-text-right">
            <h5>Top Due Customer</h5>

            </div>
            </div>
            <div class="text-right">
            <p id="fullinfosix" class="m-b-0"></p>
            </div>
            </div>*@

        </div>
        <div class="col-md-3 col-12 my-3" id="divfullinfofive">
            <div class="cards">
                <div class="card-d card-4">
                    <div class="card__icon"><i class="bi bi-lightning"></i></div>
                    <h5 class="card__exit">Top Selling Item</h5>
                    <p class="card__apply">
                        <a class="card__link" href="javascript:void(0);" id="fullinfofive"><i class="fas fa-arrow-right"></i></a>
                    </p>
                </div>
            </div>
        </div>
                @*<div id="divfullinfofive" class="card-dashboard P-15 mt-3" style="background: lavenderblush">
        <div class="media">
        <div class="media-left meida media-middle">
        <span><i class="fa fa-usd fontshadow f-s-40 color-info"></i></span>
        </div>
        <div class="media-body media-text-right">
        <h5>Top Selling Item</h5>

        </div>
        </div>
        <div class="text-right">
        <p id="fullinfofive" class="m-b-0"></p>
        </div>
        </div>*@
        <div class="col-md-3 col-12 my-3" id="divfullinfoten">
            <div class="cards">
                <div class="card-d card-5">
                    <div class="card__icon"><i class="bi bi-lightning"></i></div>
                    <h5 class="card__exit">Day Wise Sales</h5>
                    <p class="card__apply">
                        <a class="card__link" href="javascript:void(0);" id="fullinfoten"><i class="fas fa-arrow-right"></i></a>
                    </p>
                </div>
            </div>
                    @*             <div id="divfullinfoten" class="card-dashboard P-15 mt-3" style="background:ivory">
            <div class="media">
            <div class="media-left meida media-middle">
            <span><i class="fa fa-usd fontshadow f-s-40 color-danger"></i></span>
            </div>
            <div class="media-body media-text-right">
            <h5>Day Wise Sales</h5>

            </div>
            </div>
            <div class="text-right">
            <p id="fullinfoten" class="m-b-0"></p>
            </div>
            </div>



            </div>

            </div>
            </div> *@

        </div>



    </div>



</div>


<button type="button" id="checkmodalbuttonid" class="btn btn-primary d-none " data-bs-toggle="modal" data-bs-target="#exampleModal">
    Launch demo modal
</button>

<div class="modal fade modal-xl" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="card rounded-10">
                    <div id="jsChildItems"></div>

                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>

       
</div>
</div>




 @section Scripts{

    <script type="text/javascript">


        $("#CustomerId,#UserId,#WarehouseId,#Status,#CategoryId,#DocTypeId").select2({
            theme: "bootstrap-5",
        });


        var VatViewActivate = '@HttpContextAccessor.HttpContext.Session.GetInt32("VatViewActivate").ToString()';
        if (VatViewActivate == 1) { $('.divHiddenItems').hide(); }
        //var isHidden = VatViewActivate != 1;


        $(window).bind('keydown', function (event) {
            if (event.ctrlKey || event.metaKey) {
                switch (String.fromCharCode(event.which).toLowerCase()) {
                    case 'h':
                        event.preventDefault();
                        //alert('ctrl-s');
                        //alert($('#tblpayments').DataTable().data().count());
                        //if ($('#tblpayments').DataTable().data().count() == 0) {
                        //    $("#addpayment").trigger('click');
                        //}

                        //$("#BtnSave").trigger('click');
                        //alert('hit');
                        SomeAction("cntrlh");
                        return;
                        //Sales_save();
                        break;
                    case 'r':
                        event.preventDefault();
                        alert('ctrl-r');
                        ProfitAction("cntrlr");
                        return;
                        break;
                    case 'd':
                        event.preventDefault();
                        SomeAction("cntrlu");
                        //alert('ctrl-s');
                        //Sales_delete();
                        return;
                        break;
                @*case 'n':
                        event.preventDefault();
                        //alert('ctrl-n');
                        window.location.href = '@Url.Action("POSCreate", "Sales")';
                        break;
                        case 'r':
                        event.preventDefault();
                        //alert('ctrl-r');
                        window.location.href = '@Url.Action("POSCreate", "Sales")';
                        break;
                        case 'b':
                        event.preventDefault();
                        //alert('ctrl-b');
                        window.location.href = '@Url.Action("Index", "Sales")';
                        //$('#btnBack').click(function () {
                        //    ///Code
                        //});
                        break;*@
                                                                    }
            }
        });


        $('input[name=RptType]').click(function () {
            var reporttypeind = $("input[name=RptType]:checked").val();
            //alert(reporttype);

            $.ajax({
                type: 'POST',
                url: '@Url.Action("SetSessionReportType", "Accounts")',
                dataType: 'json',
                async: true,
                data: { reporttype: reporttypeind },
                success: function (response) {
                    //  window.location.href = response.Url;

                    //window.open(response.Url, '_blank')
                },
                error: function (ex) {
                    alert('Failed.' + ex);
                }

            });

        });


        function ProfitAction(commandtype) {

            var totalsaleslist = $('#saleslist').DataTable();
            var rows = totalsaleslist.rows('.selected').data();

            var pid = [];

            for (var i = 0; i < rows.length; i++) {

                var rowData = rows[i];
                pid.push(rowData["Id"]);
                //doctype.push(rowData[5]);
            }

            if ((pid == null) || (pid == "")) {
                toastr.error("Please Select Sales from the List.");
                return true;
            }

            $.ajax({
                type: 'POST',
                url: '@Url.Action("ProfitAction", "Sales")',
                dataType: 'json',
                async: true,
                data: { SalesId: pid, CommandType: commandtype },
                success: function (response) {

                    if (response.Success == "1") {

                        toastr.success(response.ex);
                        //$("#btnLoad").focus();
                    }
                    else if (response.Success == "2") {
                        toastr.warning(response.ex);
                    }

                },
                error: function (ex) {
                    alert('Failed.' + ex);
                }

            });


        }

        function SomeAction(commandtype) {

            var totalsaleslist = $('#saleslist').DataTable();
            var rows = totalsaleslist.rows('.selected').data();
            //console.log(rows.length);
            //console.log(rows);


            //var selectedsaleslist = [];
            //var pid = 0;

            //if (rows.length > 0) {
            //    pid = rows[0]["Id"];
            //}


            var pid = [];
            //var doctype = [];



            for (var i = 0; i < rows.length; i++) {

                var rowData = rows[i];
                pid.push(rowData["Id"]);
                //doctype.push(rowData[5]);

            }

            //console.log(pid);
            //alert(WarehouseId);
            //alert(btnvalue);

            if ((pid == null) || (pid == "")) {
                toastr.error("Please Select Product from the List.");
                return true;
            }

            //console.log(rows);
            //var doctype = "pdf";
            //var criteria = "DownloadReport";


            $.ajax({
                type: 'POST',
                url: '@Url.Action("SomeAction", "Sales")',
                dataType: 'json',
                async: true,
                data: { SalesId: pid, CommandType: commandtype },
                success: function (response) {

                    if (response.Success == "1") {
                        var selectedRows = table.rows(".selected");
                        selectedRows.remove().draw();
                        toastr.success(response.ex);
                        //$("#btnLoad").focus();
                    }
                    else if (response.Success == "2") {
                        toastr.warning(response.ex);
                    }

                },
                error: function (ex) {
                    alert('Failed.' + ex);
                }

            });


        }




        var filter = '@ViewBag.filter';
        $("#Status").val(filter);



        if (filter == "Due") {

            $(".FromDate").val('1-jan-' + new Date().getFullYear().toString().substr(-2));
        }


        DefaultFormat('pdf');
        $('input[type="radio"]').change(function () {
            selectedValue = this.value;
            DefaultFormat(selectedValue);

        });

        function DefaultFormat(selectedValue) {
            $.ajax({
                type: "GET",
                //url: "../Admin/SetReportFormat",
                "url": "@Url.Action("SetReportFormat", "Admin")",
                datatype: "Json",
                data: { reportformat: selectedValue },
                success: function (data) {
                    if (data.Success == 1) {
                        //toastr.success(selectedValue + " Format Selected");
                    }
                }
            });
        }


        function ReportPrint(btnvalue) {

            //var peopleList = $('#tbllist').DataTable();
            //var rows = peopleList.rows('.selected').data();

            var CustomerId = $('#CustomerId').val();
            var UserId = $('#UserId').val();
            var WarehouseId = $('#WarehouseId').val();
            var CategoryId = $('#CategoryId').val();
            var DocTypeId = $('#DocTypeId').val();


            var Status = $('#Status').val();


            var reporttype = $("input[name=RptType]:checked").val();
            var FromDate = $(".FromDate").val();
            var ToDate = $(".ToDate").val();



            ////console.log(rows.length);
            ////console.log(rows);


            //var productidlist = [];
            //var pid = 0;

            //if (rows.length > 0) {
            //    pid = rows[0]["Id"];
            //}



            //if (btnvalue == "PrintSalesListWithItem") {

            //     //if ((WarehouseId == null) || (WarehouseId == "")) {
            //     //    toastr.error("Please Select Store First.");
            //     //    return true;

            //     //}
            //     //else if ((pid == null) || (pid == ""))
            //     //{
            //     //    toastr.error("Please Select Product from the List.");
            //     //    return true;
            //     //}
            //     //alert('Wait');
            // }


            $.ajax({
                type: 'POST',
                url: '@Url.Action("AllSalesReport", "Sales")',
                dataType: 'json',
                async: true,
                data: { rptFormat: reporttype, action: btnvalue, CustomerId: CustomerId, UserId: UserId, FromDate: FromDate, ToDate: ToDate, WarehouseId: WarehouseId, CategoryId: CategoryId, Status: Status },
                success: function (response) {
                    //console.log(response.Url)
                    window.open(response.Url, '_blank')
                },
                error: function (ex) {
                    alert('Failed.' + ex);
                }

            });


        }


        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();
            //    CurrentDate();

            //    $(".FromDate").datepicker({

            //        dateFormat: "dd-M-y",
            //        changeMonth: true,
            //        changeYear: true

            //    });


            //$(".ToDate").datepicker({

            //    dateFormat: "dd-M-y",
            //    changeMonth: true,
            //    changeYear: true

            //});

            //function CurrentDate() {
            //    var date = new Date();
            //    var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            //    var val = date.getDate() + "-" + months[date.getMonth()] + "-" + date.getFullYear().toString().substr(-2);
            //    if ($(".FromDate").val() == '') {
            //        $(".FromDate").val(val);
            //    }
            //    if ($(".ToDate").val() == '') {
            //        $(".ToDate").val(val);
            //    }
            //}

            var CustomerId = $("#CustomerId").val();
            var UserId = $("#UserId").val();
            var Status = $("#Status").val();
            var WarehouseId = $("#WarehouseId").val();
            var CategoryId = $("#CategoryId").val();



            var fromdate = $("#FromDate").val();
            var todate = $("#ToDate").val();


            var permission = false;
            var UserRole = `@HttpContextAccessor.HttpContext.Session.GetString("UserRole")`;
            //alert(UserRole);
            //alert(permission);

            if (UserRole.toLowerCase().includes("admin")) { permission = true; };
            //alert(permission);

            //permission = true;


            //loaddata();

            if (permission == true) {
                loadsummarydata();

            }
            else {
                $("#divfullinfoone").hide();
                $("#divfullinfotwo").hide();
                $("#divfullinfothree").hide();
                $("#divfullinfofour").hide();
                $("#divfullinfofive").hide();
                $("#divfullinfosix").hide();
                $("#divfullinfoseven").hide();
                $("#divfullinfoeight").hide();
                $("#divfullinfonine").hide();
                $("#divfullinfoten").hide();
                $("#divfullinfoeleven").hide();

            }




            function format(d) {
                //console.log(d.Items);
                var trs = '';
                var trf = '';
                var sumindsalesprice = 0.00;
                var sumindcostprice = 0.00;
                var suminddiscount = 0.00;
                var sumindquantity = 0.00;

                var sumindprofit = 0.00;
                var sumindcomissionamount = 0.00;

                var sumsalesprice = 0.00;
                var sumcostprice = 0.00;
                var sumavgcostprice = 0.00;

                var sumprofit = 0.00;
                var sumcommission = 0.00;



                var i = 0;



                $.each($(d.SalesItems), function (key, value) {
                    //console.log(d.SalesItems[key]);
                    //console.log(value);
                    i++;
                    var indsalesprice = (parseFloat(d.SalesItems[key].Price));
                    var indcostprice = (parseFloat(d.SalesItems[key].CostPrice));
                    var indavgcostprice = (parseFloat(d.SalesItems[key].AvgCostPrice));

                    var inddiscount = (parseFloat(d.SalesItems[key].IndDiscountProportion));
                    var indquantity = (parseFloat(d.SalesItems[key].Quantity));
                    var indprofit = parseFloat(parseFloat(indsalesprice - indcostprice) * parseFloat(indquantity)) - parseFloat(inddiscount);
                    //alert(indprofit);
                    var indcomission = parseFloat(d.SalesItems[key].CommissionAmount);

                    var totalsalesprice = indsalesprice * indquantity;
                    var totalcostprice = indcostprice * indquantity;
                    var totalavgcostprice = indavgcostprice;

                    var totalprofit = totalsalesprice - totalcostprice;//- totalservicecharge - totalvat;

                    //console.log(profit);

                    sumindsalesprice += parseFloat(indsalesprice);
                    //sumindcostprice += parseFloat(indcostprice);

                    suminddiscount += parseFloat(inddiscount);
                    sumindquantity += parseFloat(indquantity);
                    //sumindprofit += indprofit.toFixed();
                    sumindcomissionamount += parseFloat(indcomission);

                    sumsalesprice += parseFloat(totalsalesprice);
                    //sumcostprice += parseFloat(totalcostprice);
                    //sumavgcostprice += parseFloat(totalavgcostprice);

                    //sumprofit += parseFloat(totalprofit.toFixed(2));
                    sumcommission += parseFloat(sumindcomissionamount);


                    if (permission == false) {
                        indcostprice = 0.00;
                        indavgcostprice = 0.00; 
                        indprofit = 0.00;
                        totalcostprice = 0.00;
                    }
                    else {
                        //alert('found');
                        sumindcostprice += parseFloat(indcostprice);

                        sumindprofit += parseFloat(indprofit.toFixed());

                        sumcostprice += parseFloat(totalcostprice);

                        sumavgcostprice += parseFloat(totalavgcostprice);

                        sumprofit += parseFloat(totalprofit.toFixed(2));

                    }


                    let allbatchno = ' ; ';
                    //console.log(d.SalesItems[key]);
                    $.each($(d.SalesItems[key].BatchSerial), function (keyabc, valueabc) {
                        allbatchno += d.SalesItems[key].BatchSerial[keyabc].BatchSerialNo + ' ; ';
                        //console.log(d.SalesItems[key].BatchSerial[keyabc].BatchSerialNo);
                    })


                    trs += '<tr><td>' + i + '</td><td>' + d.SalesItems[key].CategoryName + '</td><td>' + d.SalesItems[key].ProductCode + '</td><td>' + d.SalesItems[key].ProductName + ' ' + allbatchno + '</td><td>' + indsalesprice.toLocaleString() + '</td><td>' + indquantity.toLocaleString() + '</td><td>' + indcostprice.toLocaleString() + '</td><td>' + indavgcostprice.toLocaleString() + '</td><td>' + inddiscount.toLocaleString() + '</td><td>' + totalsalesprice.toLocaleString() + '</td><td>' + totalcostprice.toLocaleString() + '</td><td>' + indprofit.toLocaleString() + '</td><td>' + indcomission.toLocaleString() + '</td></tr>';

                })

                if (i > 1) {
                    trf += '<tr><td></td><td>Total :</td><td></td><td>Item Count : ' + i + '</td><td>' + sumindsalesprice.toLocaleString() + '</td><td>' + sumindquantity.toLocaleString() + '</td><td>' + sumindcostprice.toLocaleString() + '</td><td>' + sumavgcostprice.toLocaleString() + '</td><td>' + suminddiscount.toLocaleString() + '</td><td>' + sumsalesprice.toLocaleString() + '</td><td>' + sumcostprice.toLocaleString() + '</td><td>' + sumindprofit.toLocaleString() + '</td><td>' + sumcommission.toLocaleString() + '</td></tr>';

                }

                // `d` is the original data object for the row
                return '<div class="col-md-6"><table class="table text-center table-sm text-nowrap table-border table-hover table-condensed">' +
                    '<thead class="border">' +
                    '<th>SLNo.</th>' +
                    '<th>Category</th>' +
                    '<th>Code</th>' +
                    '<th>Product Name</th>' +
                    '<th>Sales Price</th>' +
                    '<th>Quantity</th>' +
                    '<th>Cost Price</th>' +
                    '<th>Total Average Cost</th>' +
                    '<th>Ind. Discount</th>' +
                    '<th>Total Sales</th>' +
                    '<th>Total Cost</th>' +
                    '<th>Total Profit</th>' +
                    '<th>Commission</th>' +
                    '</thead><tbody class="border">' +

                    trs +
                    '</tbody><tfoot class="text-center font-weight-bold border">' + trf + '</tfoot></table></div>';
            }



            $('#saleslist tbody').on('click', 'td.details-control', function () {
                var tr = $(this).closest('tr');
                var row = table.row(tr);

                if (row.child.isShown()) {
                    // This row is already open - close it
                    row.child.hide();
                    tr.removeClass('shown');
                }
                else {
                    // Open this row
                    row.child(format(row.data())).show();
                    tr.addClass('shown');
                }
            });


            

            //////***** JsGrid ****//////

            var globalPageSize = 5;
            function restoreDropdown() {
                $("#dropdown-titles").empty();
                for (var i = 0; i < globalFields.length; i++) {
                    var title = globalFields[i].title;
                    var name = globalFields[i].name;
                    var visible = true;
                    if (globalFields[i].visible == false) {
                        visible = false;
                    }
                    //console.log(visible);
                    titles = `<li>
                    <a class="dropdown-item" href="#">
                    <div class="custom-control custom-checkbox" >
                    <input type="checkbox" class="custom-control-input title-input" id="${name}" value="${name}">
                    <label class="custom-control-label w-100 cursor-pointer" id="${name}" for="${name}">${title}</label>
                    </div>
                    </a>
                    </li>`;

                    $("#dropdown-titles").append(titles);

                    document.querySelector(`${'#' + name}`).addEventListener('click', function () {
                        var checkbox = event.target;
                        var isChecked = checkbox.checked;
                        if (isChecked) {
                            $("#jsGridItems").jsGrid("fieldOption", this.value, "visible", true);
                        }
                        else {
                            $("#jsGridItems").jsGrid("fieldOption", this.value, "visible", false);
                        }
                    });

                    $(`${'#' + name}`).prop('checked', visible);


                    $('.custom-control-label').on('click', function (e) {
                        e.stopPropagation();
                    });
                    $('#dropdown-titles').on('click', function (e) {
                        e.stopPropagation();
                    });

                    //console.log(data.BankBalance[i].AccName);
                }

                AccType = 'L';
                IncludingInactive = false;
            }

            document.getElementById("rows").addEventListener("change", function (e) {

                globalPageSize = this.value;

                $("#jsGridItems").jsGrid({
                    pageSize: globalPageSize
                });


            });

            document.getElementById("hide-all").addEventListener("click", function (e) {
                //e.stopPropagation();
                //e.preventDefault();
                globalPageSize = 0;
                $("#jsGridItems").jsGrid({
                    pageSize: globalPageSize
                });

                $("#rows").prop('selectedIndex', 0);

            });
            document.getElementById("show-all").addEventListener("click", function (e) {

                globalPageSize = 100;
                $("#jsGridItems").jsGrid({
                    pageSize: globalPageSize
                });
                $("#rows").prop('selectedIndex', 0);

            });
            document.getElementById("restore").addEventListener("click", function (e) {

                globalPageSize = 5;

                $("#jsGridItems").jsGrid({
                    pageSize: globalPageSize
                });
                restoreDropdown();

                //$('#rows').value(0);
                $("#rows").prop('selectedIndex', 0);

            });

            var withChildFlag = false;
            document.getElementById("withChild").addEventListener("click", function (e) {


                withChildFlag = true;

                //alert('SAS');
            });


            var globalFields = [
                {
                    name: "Id",
                    title: "Id",
                    visible: false
                },
                //{
                //    title: "Sale Code",
                //    width: 175,
                //    itemTemplate: function (_, item) {
                //        var myUrlprint = '@Url.Action("SaleReport", "Sales")?SaleId=' + item.Id;
                //        var myUrlprintCH = '@Url.Action("ChallanReport", "Sales")?SaleId=' + item.Id;
                //        var myUrlprintinvoice = '@Url.Action("InvoiceViewReport", "Sales")?SaleId=' + item.Id + '&ReportType=SALES INVOICE';
                //        var myUrlprintmoneyreceipt = '@Url.Action("InvoiceViewReport", "Sales")?SaleId=' + item.Id + '&ReportType=MONEY RECEIPT';
                //        var myUrlcopy = '@Url.Action("EditSale", "Sales")?SaleId=' + item.Id + '&IsCopy=2';

                //        var SaleCode = item.SaleCode;
                //        var buttons = '';

                //        if (item.DocType === 'Sales') {
                //            buttons += '<div class="btn-group w-100">';
                //            buttons += '<button class="btn btn-default btn-sm" type="button">';
                //            buttons += '<a href="' + myUrlprint + '" class="text-primary rounded-0 fw-500" target="_blank">' + SaleCode + '</a>';
                //            buttons += '</button>';
                //            buttons += '<button type="button" class="btn btn-sm btn-default dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >';
                //            buttons += '<span class="sr-only"></span>';
                //            //buttons += '<i class="bi bi-printer"></i>';
                //            buttons += '</button>';
                //            buttons += '<div class="dropdown-menu dropdownplacement">';
                //            buttons += '<a class="dropdown-item" href="' + myUrlprintCH + '" target="_blank"><i class="bi bi-printer ml-1"></i> Challan Print</a>';
                //            buttons += '<div class="dropdown-divider"></div>';
                //            buttons += '<a class="dropdown-item" href="' + myUrlprintinvoice + '" target="_blank"><i class="bi bi-printer ml-1"></i> View Report</a>';
                //            buttons += '<div class="dropdown-divider"></div>';
                //            buttons += '<a class="dropdown-item" href="' + myUrlprintmoneyreceipt + '" target="_blank"><i class="bi bi-printer ml-1"></i> Money Receipt</a>';
                //            buttons += '<div class="dropdown-divider"></div>';
                //            buttons += '<a class="dropdown-item" href="' + myUrlcopy + '" target="_blank"><i class="bi bi-printer ml-1"></i> Duplicate Copy</a>';
                //            buttons += '</div>';
                //            buttons += '</div>';
                //        } else {
                //            buttons += '<div class="btn-group w-100">';
                //            buttons += '<button class="btn btn-outline-primary btn-sm" type="button">';
                //            buttons += '<a href="' + myUrlprint + '" class="rounded-0" target="_blank">' + SaleCode + '</a>';
                //            buttons += '</button>';
                //            buttons += '<button type="button" class="btn btn-sm btn-outline-primary form-select dropdown-toggle-split" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';
                //            buttons += '<span class="sr-only"></span>';
                //            buttons += '</button>';
                //            buttons += '<div class="dropdown-menu dropdownplacement" style="font-size:13px">';
                //            buttons += '<a class="dropdown-item" href="' + myUrlprintinvoice + '" target="_blank"><i class="bi bi-printer"></i> View Report</a>';
                //            buttons += '<div class="dropdown-divider"></div>';
                //            buttons += '<a class="dropdown-item" href="' + myUrlcopy + '" target="_blank"><i class="bi bi-printer"></i> Duplicate Copy</a>';
                //            buttons += '</div>';
                //            buttons += '</div>';
                //        }

                //        return buttons;
                //    }
                //},
                {
                    title: "Sale Code",
                    width: 175,
                    //align:'left',
                    itemTemplate: function (_, item) {
                        var myUrlprint = '@Url.Action("SaleReport", "Sales")?SaleId=' + item.Id;
                        var myUrlprintCH = '@Url.Action("ChallanReport", "Sales")?SaleId=' + item.Id;
                        var myUrlprintinvoice = '@Url.Action("InvoiceViewReport", "Sales")?SaleId=' + item.Id + '&ReportType=SALES INVOICE';
                        var myUrlprintmoneyreceipt = '@Url.Action("InvoiceViewReport", "Sales")?SaleId=' + item.Id + '&ReportType=MONEY RECEIPT';
                        var myUrlcopy = '@Url.Action("EditSale", "Sales")?SaleId=' + item.Id + '&IsCopy=2';
                        var dueamount = item.NetAmount - item.PaidAmt;
                        var myUrledit = '@Url.Action("EditSale", "Sales")?SaleId=' + item.Id;
                        var myUrldelete = '@Url.Action("DeleteSale", "Sales")?SaleId=' + item.Id;
                        var myUrlposedit = '@Url.Action("POSEdit", "Sales")?SaleId=' + item.Id;
                        var myUrlReport = '@Url.Action("SaleReport", "Sales")?SaleId=' + item.Id;
                        var myUrlAccTransaction = '@Url.Action("AddTransaction", "Admin")?Type=Sales&RefId=' + item.Id;
                        var message = `return confirm('Are you sure you want to Remove the Sales Information ?')`;

                        var SaleCode = item.SaleCode;
                        var buttons = '';

                        if (item.DocType === 'Sales') {
                            buttons += '<div class="d-grid"><div class="btn-group">';
                            buttons += '<button class="btn btn-default btn-sm text-start" type="button">';
                            buttons += '<a href="' + myUrlprint + '" class="text-primary rounded-0 fw-500" target="_blank">' + SaleCode + '</a>';
                            buttons += '</button>';
                            buttons += '<button type="button" class="btn btn-sm btn-default dropdown-toggle dropdown-toggle-split text-end" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >';
                            buttons += '<span class="sr-only"></span>';
                            //buttons += '<i class="bi bi-printer"></i>';
                            buttons += '</button>';
                            buttons += '<div class="dropdown-menu dropdownplacement">';
                            buttons += '<a class="dropdown-item" href="' + myUrlprintCH + '" target="_blank"><i class="bi bi-printer ml-1"></i> Challan Print</a>';
                            buttons += '<div class="dropdown-divider"></div>';
                            buttons += '<a class="dropdown-item" href="' + myUrlprintinvoice + '" target="_blank"><i class="bi bi-printer ml-1"></i> View Report</a>';
                            buttons += '<div class="dropdown-divider"></div>';
                            buttons += '<a class="dropdown-item" href="' + myUrlprintmoneyreceipt + '" target="_blank"><i class="bi bi-printer ml-1"></i> Money Receipt</a>';
                            buttons += '<div class="dropdown-divider"></div>';
                            buttons += '<a class="dropdown-item" href="' + myUrlcopy + '" target="_blank"><i class="bi bi-clipboard ml-1"></i> Duplicate Copy</a>';
                            buttons += '<div class="dropdown-divider"></div>';
                            // Add Edit, Delete, Collection options based on conditions


                            if (!item.isPosted) {
                                if (item.isPOSSales) {
                                    buttons += `<a class="dropdown-item" href="${myUrlposedit}" target="_blank"><i class="bi bi-pencil-square pe-1"></i>Edit</a>`;
                                } else {
                                    buttons += `<a class="dropdown-item" href="${myUrledit}" target="_blank"><i class="bi bi-pencil-square pe-1"></i>Edit</a>`;
                                }

                                buttons += '<div class="dropdown-divider"></div>';
                                buttons += `<a class="dropdown-item" href="${myUrldelete}" onclick="${message}" target="_blank"><i class="bi bi-x-lg pe-1"></i>Delete</a>`;

                            }

                            let dueamountabc = item.NetAmount - (item.PaidAmt - item.SalesReturnPayments - item.SalesReturnAmount);

                            if (dueamountabc > 0.9) {
                                buttons += '<div class="dropdown-divider"></div>';
                                if (dueamount > 0 && item.DocType !== 'Quotation') {
                                    buttons += `<a class="dropdown-item" href="${myUrlAccTransaction}" target="_blank"><i class="bi bi-cash pe-1"></i>Collection</a>`;
                                }
                            }




                            buttons += '</div>';
                            buttons += '</div>';
                            buttons += '</div>';
                        } else {
                            buttons += '<div class="btn-group">';
                            buttons += '<button class="btn btn-outline-primary btn-sm" type="button">';
                            buttons += '<a href="' + myUrlprint + '" class="rounded-0" target="_blank">' + SaleCode + '</a>';
                            buttons += '</button>';
                            buttons += '<button type="button" class="btn btn-sm btn-outline-primary form-select dropdown-toggle-split" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';
                            buttons += '<span class="sr-only"></span>';
                            buttons += '</button>';
                            buttons += '<div class="dropdown-menu dropdownplacement" style="font-size:13px">';
                            buttons += '<a class="dropdown-item" href="' + myUrlprintinvoice + '" target="_blank"><i class="bi bi-printer"></i> View Report</a>';
                            buttons += '<div class="dropdown-divider"></div>';
                            buttons += '<a class="dropdown-item" href="' + myUrlcopy + '" target="_blank"><i class="bi bi-printer"></i> Duplicate Copy</a>';
                            buttons += '</div>';
                            buttons += '</div>';
                        }

                        return buttons;
                    }
                },
                {
                    name: 'details-control',
                    title: 'Details',

                    width: '70',
                    align: 'center',
                    itemTemplate: function (value, item) {
                        var $iconPencil = $(" <input class='jsgrid-button jsgrid-insert-button' type = 'button' title = 'Details' >").click(function (e) {
                            $("#checkmodalbuttonid").trigger('click');
                        });

                        var $result = jsGrid.fields.control.prototype.itemTemplate.apply(this, arguments);
                        return $result.add($iconPencil);
                    }
                },
                {
                    name: "SalesUser",
                    title: "Entry By",
                    type: "text",
                    sorting: true,
                    className: "text-center",
                    searchable: true
                },
                {
                    name: "SalesDateString",
                    title: "Sales Date",
                    sorting: true,
                    className: "text-nowrap text-center",
                    searchable: false,
                    orderable: false
                },
                {
                    name: "EntryTimeString",
                    title: "Time",
                    sorting: true,
                    className: "text-nowrap text-center",
                    searchable: false,
                    orderable: false
                },
                {
                    name: "CustomerName",
                    title: "Customer",
                    type: "text",
                    sorting: true,
                    className: "text-center",
                    searchable: true
                },
                {
                    name: "PrimaryAddress",
                    title: "Address",
                    type: "text",
                    className: "text-center",
                    searchable: true
                },
                {
                    name: "PhoneNo",
                    title: "Mobile",
                    type: "text",
                    searchable: true
                },
                {
                    name: "Notes",
                    title: "Notes",
                    sorting: true,
                    className: "text-center",
                    searchable: true
                },
                {
                    name: "Total",
                    title: "Total",
                    align: 'center',
                    sorting: true,
                    itemTemplate: function (_, item) {
                        return item.Total.toLocaleString();
                    },
                    searchable: false
                },
                {
                    name: "Discount",
                    title: "Discount",
                    searchable: true
                },
                {
                    name: "ServiceCharge",
                    title: "Service Charge",
                    className: "text-center",
                    searchable: true
                },
                {
                    name: "TotalVat",
                    title: "VAT",
                    className: "text-center",
                    searchable: true
                },
                {
                    name: "Shipping",
                    title: "Shipping",
                    className: "text-center",
                    searchable: true
                },
                {
                    name: "NetAmount",
                    title: "Net.Amt.",
                    type: "text",
                    align: 'center',
                    sorting: true,
                    itemTemplate: function (_, item) {
                        return (item.NetAmount + item.SalesReturnAmount).toLocaleString();
                    },
                    searchable: true
                },
                {
                    name: "PaidAmt",
                    title: "Rcvd.Amt.",
                    align: 'center',
                    sorting: true,
                    itemTemplate: function (_, item) {
                        return item.PaidAmt.toLocaleString();
                    },
                    searchable: true
                },
                {
                    name: "Location",
                    title: "Location",
                    type: "text",
                    sorting: true,
                    align: 'center',
                    searchable: true
                },
                {
                    name: "SalesPayments",
                    title: "Received By",
                    type: "text",
                    sorting: true,
                    className: "text-nowrap text-center",
                    searchable: true,
                    itemTemplate: function (_, item) {
                        var dueamount = item.NetAmount - (item.PaidAmt - item.SalesReturnPayments - item.SalesReturnAmount);
                        var output = "";

                        if (item.SalesPayments.length !== 0) {
                            for (var i = 0; i < item.SalesPayments.length; i++) {
                                if (item.SalesPayments[i].AccName != null) {
                                    output += '<p class="narrowlineheight" style="font-weight: bold; color:darkgreen">' + item.SalesPayments[i].AccName + " : " + item.SalesPayments[i].Amount.toLocaleString();
                                } else {
                                    output += '<p class="narrowlineheight" style="font-weight: bold; color:red">' + item.SalesPayments[i].TransactionCode + " <br> Missing Receiving Head";
                                }

                                if (i < item.SalesPayments.length - 1) {
                                    output += '</span>';
                                }
                            }

                            if (dueamount > 0.9) {
                                output += '<p class="narrowlineheight" style="font-weight: bold; color:red">Due  : ' + dueamount.toLocaleString() + '</span>';
                            } else if (dueamount < 0) {
                                output += '<p class="narrowlineheight" style="font-weight: bold; color:brown">Excess Rcvd.  : ' + dueamount.toLocaleString() + '</span>';
                            }

                            return output;
                        } else {
                            output += '<p class="narrowlineheight" style="font-weight: bold; color:red">Due : ' + dueamount.toLocaleString() + '</span>';
                            return output;
                        }
                    }
                },
                {
                    name: "FinalCostingPrice",
                    title: "Total Cost",
                    align: 'center',
                    type: "text",
                    itemTemplate: function (_, item) {
                        return item.FinalCostingPrice.toLocaleString();
                    },
                    searchable: true,
                    visible: permission
                },
                {
                    name: "Profit",
                    title: "Profit",
                    align: 'center',
                    type: "text",
                    itemTemplate: function (_, item) {
                        return item.Profit.toLocaleString();
                    },
                    searchable: true,
                    visible: permission
                },
                {
                    name: "ProfitPercentage",
                    title: "Profit%",
                    align: 'center',
                    itemTemplate: function (_, item) {
                        return item.ProfitPercentage.toLocaleString();
                    },
                    searchable: true,
                    visible: permission
                },
                {
                    name: "isPosted",
                    title: "Post.Status",
                    width: '120',
                    itemTemplate: function (_, item) {
                        if (!item.isPosted) {
                            return '<p class="narrowlineheight" style="font-weight: bold; color:red">Not Posted</p>';
                        } else {
                            return '<p class="narrowlineheight" style="font-weight: bold; color:darkgreen">Posted</p>';
                        }
                    }
                }
                //{
                //    title: 'Actions',
                //    width: '120',

                //    align: 'center',
                //    itemTemplate: function (_, item) {
                //        var dueamount = item.NetAmount - item.PaidAmt;
                //        var myUrledit = '@Url.Action("EditSale", "Sales")?SaleId=' + item.Id;
                //        var myUrldelete = '@Url.Action("DeleteSale", "Sales")?SaleId=' + item.Id;
                //        var myUrlposedit = '@Url.Action("POSEdit", "Sales")?SaleId=' + item.Id;
                //        var myUrlReport = '@Url.Action("SaleReport", "Sales")?SaleId=' + item.Id;
                //        var myUrlAccTransaction = '@Url.Action("AddTransaction", "Admin")?Type=Sales&RefId=' + item.Id;
                //        var message = `return confirm('Are you sure you want to Remove the Sales Information ?')`;

                //        var buttons = '<div class="btn-group">';
                //        buttons += '<button type="button" class="btn btn-sm shadow-none blue-custom fw-500"><a href="#">View Register</a></button>';
                //        buttons += '<button type="button" class="btn btn-sm dropdown-toggle dropdown-toggle-split shadow-none" data-bs-toggle="dropdown" aria-expanded="false">';
                //        buttons += '<span class="visually-hidden"></span>';
                //        buttons += '</button>';
                //        buttons += '<ul class="dropdown-menu">';
                //        if (item.isPOSSales) {
                //            buttons += `<li><a href="${myUrlposedit}" class="dropdown-item" target="_blank"><i class="bi bi-pencil-square pe-1"></i>Edit</a></li>`;
                //        } else {
                //            buttons += `<li><a href="${myUrledit}" class="dropdown-item" target="_blank"><i class="bi bi-pencil-square pe-1"></i>Edit</a></li>`;
                //        }
                //        buttons += `<li><a href="${myUrldelete}" onclick="${message}" class="dropdown-item" target="_blank"><i class="bi bi-x pe-1"></i>Delete</a></li>`;
                //        if (dueamount > 0 && item.DocType !== 'Quotation') {
                //            buttons += `<li><a href="${myUrlAccTransaction}" class="dropdown-item" target="_blank"><i class="bi bi-collection pe-1"></i>Collection</a></li>`;
                //        }
                //        buttons += '</ul>';
                //        buttons += '</div>';
                //        return buttons;
                //    }
                //}

            ];



            var jsGridItemsUrl = '@Url.Action("GetSalesListByPage", "Sales")';
            function initJsGrid() {
                var jsGridItemsDB = {
                    loadData: function (filter) {
                        console.log(filter);
                        var d = $.Deferred();
                        $.ajax({
                            type: "GET",
                            url: jsGridItemsUrl,
                            //headers: {
                            //    contentType: "application/json; charset=utf-8",
                            //    Authorization: token
                            //},
                            data: { searchquery: JSON.stringify(filter) },
                            contentType: "application/json; charset=utf-8",
                            dataType: "json"
                        })

                            .done(function (result) {
                                console.log("jsgrid", result);
                                d.resolve(result);
                                //console.log(result.ProductList);

                            });
                        return d.promise().then(function (q) {

                            //console.log(q);
                            return {

                                data: q,
                                itemsCount: parseInt(q.PageInfo.TotalRecordCount)
                            }
                        });
                    }

                    //    .done(function(result) {
                    //        d.resolve(result.VoucherList);

                    //        //for (let i = 0; i < result.ProductList.length; i++) {
                    //        //    result.ProductList[i].Quantity = 0;


                    //        //}
                    //        console.log('///smrity');
                    //         console.log(result.VoucherList);

                    //    });
                    //return d.promise();

                }



                //$("#exampleModal").on('hide.bs.modal', function () {
                //      $("#jsGridItems .jsgrid-update-button").trigger( "click" );
                //  });

                var child = [];

                var serial = 0;
                $("#jsGridItems").jsGrid({
                    width: "100%",
                    height: 550,
                    filtering: true,
                    editing: true,
                    autoload: true,
                    pageSize: globalPageSize,
                    pageLoading: true,
                    pageIndex: 1,
                    paging: true,
                    controller: jsGridItemsDB,
                    pagerFormat: "{prev} {pages} {next}   Results: {pageIndex} - {pageCount} of {itemCount}",
                    pagePrevText: "<",
                    pageNextText: ">",
                    // selecting: true,

                    fields: globalFields,
                    rowClick: function (args) {
                        // this.select(args.itemIndex, true);

                        // console.log(args.item);
                        // var Item=args.item;

                        child = args.item.SalesItems;

                        //// delete (Item);
                        showModal(child, args.item.SaleCode);

                        // $("#jsGridItems").jsGrid("updateItem", args.item);


                        $checkbox = $(args.event.currentTarget).find("input[type=checkbox]");
                        if ($(args.event.target).closest("td").index() !== 8 && $(args.event.target).closest("td").index() !== 0 && $(args.event.target).closest("td").index() !== 1) {
                            $checkbox.prop("checked", !$checkbox.prop("checked"));

                            // Update selected items array
                            if ($checkbox.prop("checked")) {
                                selectItem(args.item);
                            } else {
                                unselectItem(args.item);
                            }
                        }

                    },

                    onItemDeleting: function (args) {
                        console.log(args.item);
                        var abcvalue = args.item.isPosted;
                        console.log(abcvalue);
                        if (abcvalue == true) {
                            //$("#grid").jsGrid("deleteItem", args);
                            args.cancel = true;
                            alert('Already Posted');
                        }

                    },
                    onItemDeleted: function (args) {
                        parentValue = $('#jsGridItems').jsGrid('option', 'data');
                        var serial = 0;
                        for (var i = 0; i < parentValue.length; i++) {
                            parentValue[i].SLNo = serial + 1;
                            serial++;
                        }
                        console.log('serial');
                        console.log(serial);
                        $("#jsGridItems").jsGrid("refresh");

                    }

                });

            }
            initJsGrid();
            restoreDropdown();

            $(document).ready(function () {
                $('#CustomerId, #UserId, #WarehouseId, #CategoryId, #Status, #DocTypeId').on('change', function () {
                    // Display an alert message
                    //alert('Success! Date changed.');
                    //alert('hit');
                    sendData();
                    loadsummarydata();
                });
            });
            //$(document).ready(function () {
            $('#daterange-btn').on('apply.daterangepicker', function () {
                   // alert("show");
                    sendData();
                    loadsummarydata();
                });
            //});
            function sendData() {

                var jsSendDataDB = {
                    loadData: function (filter) {
                        console.log(filter);
                        var d = $.Deferred();
                        $.ajax({
                            type: "GET",
                            url: jsGridItemsUrl,
                            //headers: {
                            //    contentType: "application/json; charset=utf-8",
                            //    Authorization: token
                            //},
                            data: { searchquery: JSON.stringify(filter), FromDate: $("#FromDate").val(), ToDate: $("#ToDate").val() },
                            contentType: "application/json; charset=utf-8",
                            dataType: "json"
                        })

                            .done(function (result) {
                                //console.log(result);
                                d.resolve(result);
                                //console.log(result.ProductList);

                            });
                        return d.promise().then(function (q) {

                            //console.log(q);
                            return {

                                data: q.VoucherList,
                                itemsCount: parseInt(q.PageInfo.TotalRecordCount)
                            }
                        });
                    }

                }

                $("#jsGridItems").jsGrid({
                    controller: jsSendDataDB
                })

            }



            function showModal(child, SaleCode) {
                $("#exampleModalLabel").text("Sales Code: " + SaleCode);
                $('#jsChildItems').jsGrid({
                    data: child
                });

            }

            $('#jsChildItems').jsGrid({
                width: '100%',
                fields: [
                    { name: "Id", title: 'SLNo.' },
                    { name: "CategoryName", title: 'Category' },
                    { name: "ProductCode", title: 'Code' },
                    { name: "ProductName", title: 'Product Name' },
                    { name: "Price", title: 'Sales Price' },
                    { name: "Quantity", title: 'Quantity' },
                    { name: "CostPrice", title: 'Cost Price' },
                    { name: "AvgCostPrice", title: 'Total Average Cost' },
                    { name: "IndDiscountProportion", title: 'Ind. Discount' },
                    //{ name: "TotalSales", title: 'Total Sales' },
                    //{ name: "TotalCost", title: 'Total Cost' },
                    //{ name: "TotalProfit", title: 'Total Profit' },
                    { name: "CommissionAmount", title: 'Commission' },
                    { name: "AccType", title: 'Type', visible: false }
                ]
            });
            

            //////***** JsGrid ****//////

            function loadsummarydata() {

                //alert($("#FromDate").val());

                var x = $("#FromDate").val();
                var y = $("#ToDate").val();
                var CustomerId = $("#CustomerId").val();
                var UserId = $("#UserId").val();
                var Status = $("#Status").val();
                var WarehouseId = $("#WarehouseId").val();
                var CategoryId = $("#CategoryId").val();
                var DocTypeId = $("#DocTypeId").val();

                //alert(x , y);
                $.ajax({
                    url: '@Url.Action("GetSaleSummaryInfo", "Sales")',
                    data: { FromDate: x, ToDate: y, CustomerId: CustomerId, UserId: UserId, WarehouseId: WarehouseId, CategoryId: CategoryId, DocTypeId: DocTypeId },
                    //data: JSON.stringify(purchasesmain),
                    //type: 'POST',
                    //async: true,
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (result) {
                        //console.log(result);
                        //alert('Wait fahad');
                        //console.log(result.salesbyuser);
                        //console.log(result.salesreceivebyhead);
                        var output = "";
                        if (result.salesbyuser.length != 0) {
                            for (var i = 0; i < result.salesbyuser.length; i++) {
                                if (result.salesbyuser[i] != null) {
                                    //console.log(result.salesbyuser[i]);
                                    output += '<span class="d-block">' + result.salesbyuser[i].UserName + " : " + result.salesbyuser[i].TotalSalesCount + " : " + result.salesbyuser[i].TotalSalesSum.toLocaleString() + ' </span>'
                                }
                            };
                            $("#divfullinfoone").show();
                            document.getElementById("fullinfoone").innerHTML = output;
                        }
                        else {
                            $("#divfullinfoone").hide();
                        }



                        output = "";
                        if (result.commissionbyuser.length != 0) {
                            for (var i = 0; i < result.commissionbyuser.length; i++) {
                                if (result.commissionbyuser[i] != null) {
                                    //console.log(result.commissionbyuser[i]);
                                    output += '<span class="d-block">' + result.commissionbyuser[i].UserName + " : " + result.commissionbyuser[i].TotalSalesCount + " : " + result.commissionbyuser[i].TotalCommissionAmount + ' </span>'
                                }
                            };
                            $("#divfullinfofour").show();
                            document.getElementById("fullinfofour").innerHTML = output;
                        }
                        else {
                            $("#divfullinfofour").hide();
                        }

                        output = "";
                        if (result.totalsalessummary.length != 0) {
                            for (var i = 0; i < result.totalsalessummary.length; i++) {
                                if (result.totalsalessummary[i] != null) {
                                    //console.log(result.totalsalessummary[i]);
                                    output += '<span class="d-block"> Total Sales :' + result.totalsalessummary[i].TotalSalesCount + ' </span>'
                                    output += '<span class="d-block"> Total Sales Value : ' + result.totalsalessummary[i].TotalSalesValue.toLocaleString() + ' </span>'
                                    output += '<span class="d-block"> Total Costing : ' + result.totalsalessummary[i].TotalCosting.toLocaleString() + ' </span>'
                                    output += '<span class="d-block"> Total Discount : ' + result.totalsalessummary[i].TotalDiscount.toLocaleString() + ' </span>'
                                    output += '</hr><p class="text-bold"> Total Profit : ' + result.totalsalessummary[i].TotalProfit.toLocaleString() + ' </span>'
                                }
                            };
                            $("#divfullinfotwo").show();
                            document.getElementById("fullinfotwo").innerHTML = output;
                        }
                        else {
                            $("#divfullinfotwo").hide();
                        }
                        output = "";
                        if (result.salesreceivebyhead.length != 1) {
                            for (var i = 0; i < result.salesreceivebyhead.length; i++) {
                                if (result.salesreceivebyhead[i] != null) {
                                    //console.log(result.salesreceivebyhead[i]);


                                    if (result.salesreceivebyhead[i].AccName == "Due" && result.salesreceivebyhead[i].Amount != 0) {
                                        output += '<span class="d-block text-danger">Total Due  : ' + result.salesreceivebyhead[i].Amount.toLocaleString() + '</span>';
                                    }
                                    else {
                                        output += '<span class="d-block">' + result.salesreceivebyhead[i].AccName + " : " + result.salesreceivebyhead[i].Amount.toLocaleString() + ' </span>'
                                    }

                                }
                            };
                            $("#divfullinfothree").show();
                            document.getElementById("fullinfothree").innerHTML = output;

                        }
                        else {

                            $("#divfullinfothree").hide();
                        }


                        var output = "";
                        if (result.topsellingitem.length != 0) {
                            for (var i = 0; i < result.topsellingitem.length; i++) {
                                if (result.topsellingitem[i] != null) {
                                    //console.log(result.topsellingitem[i]);
                                    output += '<span class="d-block">' + result.topsellingitem[i].ProductName + " : " + result.topsellingitem[i].ProductCount + ' </span>'
                                }
                            };
                            $("#divfullinfofive").show();
                            document.getElementById("fullinfofive").innerHTML = output;
                        }
                        else {

                            $("#divfullinfofive").hide();
                        }

                        output = "";
                        if (result.topsellingcustomer.length != 0) {
                            for (var i = 0; i < result.topsellingcustomer.length; i++) {
                                if (result.topsellingcustomer[i] != null) {

                                    if (result.topsellingcustomer[i].CustomerName == "") {
                                        result.topsellingcustomer[i].CustomerName = "=N/A=";
                                    }

                                    //console.log(result.topsellingcustomer[i]);
                                    output += '<span class="d-block">' + result.topsellingcustomer[i].CustomerName + " : " + result.topsellingcustomer[i].SalesAmount.toLocaleString() + ' </span>'
                                }
                            };
                            $("#divfullinfoseven").show();
                            document.getElementById("fullinfoseven").innerHTML = output;
                        }
                        else {

                            $("#divfullinfoseven").hide();
                        }



                        output = "";
                        if (result.topduecustomer.length != 0) {
                            for (var i = 0; i < result.topduecustomer.length; i++) {

                                var DueAmount = result.topduecustomer[i].TotalSales - result.topduecustomer[i].ReceivedAmount;

                                if (result.topduecustomer[i].CustomerName == "") {
                                    result.topduecustomer[i].CustomerName = "=N/A=";
                                }


                                if (result.topduecustomer[i] != null && DueAmount > 0) {
                                    output += '<span class="d-block">' + result.topduecustomer[i].CustomerName + " : " + DueAmount.toLocaleString() + ' </span>'
                                }
                            };
                            $('#divfullinfosix').show();
                            document.getElementById("fullinfosix").innerHTML = output;

                        }
                        else {

                            $("#divfullinfosix").hide();
                        }


                        output = "";
                        if (result.postunpostcount.length != 0) {
                            for (var i = 0; i < result.postunpostcount.length; i++) {
                                if (result.postunpostcount[i] != null && result.postunpostcount[i].DocCount > 0 && result.postunpostcount[i].isPosted == false) {
                                    output += '<span class="d-block">' + "Not Posted : " + result.postunpostcount[i].DocCount + ' </span>'
                                }
                                else {
                                    output += '<span class="d-block">' + "Posted : " + result.postunpostcount[i].DocCount + ' </span>'
                                }
                            };
                            $('#divfullinfoeight').show();
                            document.getElementById("fullinfoeight").innerHTML = output;
                        }
                        else {
                            $("#divfullinfoeight").hide();
                        }


                        var categorytotalprofit = 0.00;
                        var categorytotalprofitavg = 0.00;

                        output = "";
                        if (result.sellingitembycategory.length != 0) {
                            for (var i = 0; i < result.sellingitembycategory.length; i++) {
                                if (result.sellingitembycategory[i] != null) {
                                    //console.log(result.topsellingitem[i]);
                                    //output += '<span="d-block">' + result.sellingitembycategory[i].CategoryName + " (" + result.sellingitembycategory[i].CategoryCount + ") " + result.sellingitembycategory[i].TotalSales.toLocaleString() + " || " + result.sellingitembycategory[i].TotalProfitAvgCost.toLocaleString() + ' </span>'
                                    output += '<span="d-block">' + result.sellingitembycategory[i].CategoryName + " (" + result.sellingitembycategory[i].CategoryCount + ") " + result.sellingitembycategory[i].TotalSales.toLocaleString() + ' </span>'
                                    categorytotalprofit += parseFloat(result.sellingitembycategory[i].TotalProfit);
                                    categorytotalprofitavg += parseFloat(result.sellingitembycategory[i].TotalProfitAvgCost);

                                }
                            };
                            output += '<hr class="solid"><span class="d-block"> Total Profit : ' + categorytotalprofit.toLocaleString() + ' || ' + categorytotalprofitavg.toLocaleString() + '(Avg.Cst) </span>'
                            $('#divfullinfonine').show();
                            document.getElementById("fullinfonine").innerHTML = output;
                        }
                        else {
                            $("#divfullinfonine").hide();
                        }


                        ///console.log(result.daywisesalescount);
                        output = "";
                        if (result.daywisesalescount.length != 0) {
                            for (var i = 0; i < result.daywisesalescount.length; i++) {

                                //var DueAmount = result.daywisesalescount[i].TotalSales - result.daywisesalescount[i].ReceivedAmount;
                                if (result.daywisesalescount[i] != null) {
                                    output += '<span class="d-block">' + result.daywisesalescount[i].SalesDate + " : " + result.daywisesalescount[i].TotalSalesCount + " : " + result.daywisesalescount[i].TotalSalesSum.toLocaleString() + ' </span>'
                                }
                            };
                            $('#divfullinfoten').show();
                            document.getElementById("fullinfoten").innerHTML = output;

                        }
                        else {

                            $("#divfullinfoten").hide();
                        }
                        //toastr.success('Sales Summary Load Successfully.');
                        //alert('Wait');
                    },
                    error: function () {
                        toastr.error('Unable to Load');
                        //alert('Unable to Save');
                    }
                });


            };


        });







                @*var CultureInfoViewFormat = '@HttpContextAccessor.HttpContext.Session.GetString("CultureInfoViewFormat").ToString()';
        var CurrencyShortNameViewFormat = '@HttpContextAccessor.HttpContext.Session.GetString("CurrencyShortName").ToString()';


        var formatter = new Intl.NumberFormat(CultureInfoViewFormat, ///'en-US'
        {
        style: 'currency',
        currency: CurrencyShortNameViewFormat,///'BDT'
        minimumFractionDigits: 2,
        });*@

    </script>




    }










