@*@model IEnumerable<InternalTransfer.Core.Entity.InternalTransferModel>*@
@{ ViewData["Title"] = "Internal Transfer List";
    Layout = "~/Views/Shared/_adminLayout.cshtml"; }


<style>
    /*div.dataTables_wrapper div.dataTables_filter input {
        width: 130px;
    }
*/
    .p-15 {
        padding: 10px 13px 15px 13px !important;
    }

    .card-dashboard p {
        font-size: 12px;
        font-family: arial narrow;
    }

    .media p {
        font-size: 14px;
        font-family: "Arial Narrow";
    }

    .media {
        font-size: 12px;
        font-family: "Arial Narrow";
        text-align: right;
        padding-bottom: 2px !important;
    }

    a {
        color: #0a275ec9;
    }
/*
    tbody tr td {
        font-family: "Arial Narrow";
        font-size: 13px;
    }*/

    .lineheight {
    margin-bottom:1px;
    }
    h5 {
        margin-top: 5px;
        margin-bottom: 1px;
    }



    .table-sm th {
/*        padding: 5px;
        font-size: 13px;*/
/*        border-color: black;
        border-bottom-width:10px;*/
    }

    hr.solid {
        border-top: 2px solid #bbb;
        margin-top: .2rem;
        margin-bottom: .2rem;
        vertical-align: middle;
    }
</style>

<div class="page-wrapper">
    <div class="container-fluid">
        <!-- Start Page Content -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                               @Html.Hidden("FromDate", null, new { @class = "form-control text-center FromDate", @placeholder = "From Date", @autocomplete = "off", name = "FromDate" })
                                @Html.Hidden("ToDate", null, new { @class = "form-control text-center ToDate", @placeholder = "To Date", @autocomplete = "off", name = "ToDate" })


                        @*<h5 class="card-header">InternalTransfer List</h5>*@
                        <div class="row mb-2">
                            <div class="col-md-3 col-12">
                                @Html.ActionLink("Internal Transfer With Scan", "AddInternalTransfer", null, null, new { @class = "btn btn-outline-success btn-block rounded-0", @id = "btnBack" })
                            </div>
                            <div class="col-md-3 col-12">
                                <h4 style="color: #1976d2;">Internal Transfer List</h4>
                            </div>
                        </div>


                        <div class="card p-1 mb-1">
                            <div class="row">
                                <div class="col-md-2 col-12">
                                    <div class="input-group mb-2">
                                        @Html.DropDownList("Customers", ViewBag.Customers as List<SelectListItem>, "Select Customers", new { id = "CustomerId", @class = "form-control form-control-sm" })
                                    </div>
                                </div>
                                 <div class="col-md-6 col-12  mb-2">
                                               <div class="form-inline divHiddenItems">
                                         <div class="input-group input-group-sm">
                                        <div >
                                            <div class="input-group-text">
                                               <i class="bi bi-calendar"></i>
                                             </div>
                                        </div>
                                        <input type="text" class="form-control from-control-sm" name="date" id="daterange-btn" style="width: auto;">
                                         <button id='btnDec' type="button" class="btn btn-danger rounded-0" title='Decrement month'><i class="bi bi-calendar-minus" aria-hidden="true"></i></button>
                                        <button id='btnInc' type="button" class="btn btn-info  rounded-0" title='Increment month'><i class="bi bi-calendar-plus" aria-hidden="true"></i></button>
                                        </div>
                                        @*<span type="button" class="btn btn-sm btn-outline-info" id="daterange-btn">

                                            <i class="bi bi-calendar"></i>&nbsp; <span>defaut date</span>

                                            <i class="fa fa-caret-down"></i>
                                        </span>
                                        <input id="daterange-btn" size="40" value="">*@
                                    </div>
                                </div>

@*                                <div class="col-md-3 col-12">
                                    <div class="input-group input-group-sm mb-1">
                                        <div >
                                            <span class="input-group-text py-0">
                                                <label for="FDate">From Date</label>
                                            </span>
                                        </div>
                                        @Html.TextBox("FromDate", null, new { @class = "form-control text-center FromDate", @placeholder = "Select From Date ", @autocomplete = "off", name = "FromDate" })
                                    </div>
                                </div>
                                <div class="col-md-3 col-12">
                                    <div class="input-group input-group-sm mb-1">
                                        <div >
                                            <span class="input-group-text py-0">
                                                <label for="TDate">To Date</label>
                                            </span>
                                        </div>
                                        @Html.TextBox("ToDate", null, new { @class = "form-control text-center ToDate", @placeholder = "Select To Date ", @autocomplete = "off", name = "ToDate" })
                                    </div>
                                </div>*@
                                <div class="col-md-3 col-12">
                                    <label class="pr-2"><input type="radio" name="RptType" value="PDF" checked="checked" /> PDF  </label>
                                    <label class="pr-2"><input type="radio" name="RptType" value="EXCEL" /> EXCEL  </label>
                                    <label class="pr-2"><input type="radio" name="RptType" value="WORD" /> WORD  </label>

                                </div>

                            </div>
                        </div>


                        <div class="table-responsive m-t-10">
                            <table id="InternalTransferlist" class="table table-sm text-nowrap table-bordered table-striped table-hover" width="100%">
                                >

                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End PAge Content -->
    </div>
</div>






@section Scripts{

    <script TransactionId="text/javascript">

        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();
        //    CurrentDate();

        //    $(".FromDate").datepicker({

        //        dateFormat: "dd-M-y",
        //        changeMonth: true,
        //        changeYear: true

        //    });


        //$(".ToDate").datepicker({

        //    dateFormat: "dd-M-y",
        //    changeMonth: true,
        //    changeYear: true

        //});

        //function CurrentDate() {
        //    var date = new Date();
        //    var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        //    var val = date.getDate() + "-" + months[date.getMonth()] + "-" + date.getFullYear().toString().substr(-2);
        //    if ($(".FromDate").val() == '') {
        //        $(".FromDate").val(val);
        //    }
        //    if ($(".ToDate").val() == '') {
        //        $(".ToDate").val(val);
        //    }
        //}

        var CustomerId = $("#CustomerId").val();
        var fromdate = $("#FromDate").val();
            var todate = $("#ToDate").val();


        loaddata(fromdate, todate, CustomerId ,1);



        function loaddata(FromDate = "", ToDate = "", CustomerId = "", isAll = 1) {
            //alert(CustomerId, FromDate, ToDate);

            table = $('#InternalTransferlist').DataTable({
                initComplete: function () {

                    var input = $('.dataTables_filter input').unbind(),
                        self = this.api(),

                        $searchButton = $('<button class="btn rounded-0 btn-info btn-sm" tabindex="0" aria-controls="InternalTransferlist" TransactionId="button" title="Search"><span><i class="bi bi-file-earmark-excel"></i></span></button>')
                            .text('Search')
                            .click(function () {
                                if (input.val().length > 0) {
                                    self.search(input.val()).draw();

                                }
                                else {
                                    loaddata(fromdate, todate, CustomerId, 1);

                                }
                            }),
                        $allButton = $('<button class="ml-1 btn rounded-0 btn-primary btn-sm" tabindex="0" aria-controls="InternalTransferlist" TransactionId="button" title="Load"><span><i class="bi bi-file-earmark-excel"></i></span></button>')
                            .text('Load')
                            .click(function () {
                                input.val('');
                                //alert(FromDate);
                                loaddata(fromdate, todate, CustomerId, 1);
                                //table.ajax.reload();


                            })
                    $('.dataTables_filter').append($allButton, $searchButton);//, $clearButton
                },

                serverSide: true,  "scrollX": true,
                "orderCellsTop": true,

                "iDisplayLength": 10,
                "lengthMenu": [[5, 10, 20, 50, -1], [5, 10, 20, 50, "All"]],

                dom: '<"dom_wrapper fh-fixedHeader"lBf>tip',

                buttons: {
                    dom: {
                        button: {
                            className: 'btn btn-sm rounded-0'
                        }
                    },
                    buttons: [
                    ]
                },
                "ajax": {
                    "url": "@Url.Action("GetInternalTransferList", "InternalTransfer")",
                    "data": { FromDate: $("#FromDate").val(), ToDate: $("#ToDate").val(), CustomerId: $("#CustomerId").val(), isAll: isAll },
                    "type": "POST",
                    "datatype": "json"
                },
                "columns": [
                            { "title": "Id", "data": "Id", "visible": false },
                            { "title": "Internal Transfer Code", "data": "InternalTransferCode", "searchable": true },
                            { "title": "Internal Transfer Date", "data": "InternalTransferDateString", "searchable": false },
                            { "title": "Referance One", "data": "ReferanceOne", "searchable": true },
                            { "title": "Referance Two", "data": "ReferanceTwo", "searchable": true },
                            { "title": "Notes / Description / Remarks", "data": "Notes", "searchable": true },
                            { "title": "Post Status",
                                "data": {
                                    Id: "Id" //,
                                },
                                "render": function (data, type, row) {
                                    var information = '';
                                    if (!data.isPosted) {
                                        information = 'Not Posted';
                                    }
                                    else
                                    {
                                        information = 'Posted';
                                    }
                                    return information;
                                }

                            },
                            {
                                "title": "Action",
                                "className" : "text-nowrap",
                                //"data": "Id",
                                "data": {
                                    Id: "Id" //,
                                    //VoucherTypeName:"VoucherTypeName",
                                    //isPosted:"isPosted"
                                },
                                "render": function (data, type, row) {

                                    var myUrledit = '@Url.Action("EditInternalTransfer", "InternalTransfer")?InternalTransferId=' + data.Id;
                                    var myUrldelete = '@Url.Action("DeleteInternalTransfer", "InternalTransfer")?InternalTransferId=' + data.Id;
                                    var myUrlposedit = '@Url.Action("POSEdit", "InternalTransfer")?InternalTransferId=' + data.Id;
                                    var myUrlSerialInternalTransferedit = '@Url.Action("EditInternalTransferBySerialSearch", "InternalTransfer")?InternalTransferId=' + data.Id;

                                    var myUrlReport = '@Url.Action("InternalTransferReport", "InternalTransfer")?InternalTransferId=' + data.Id;
                                    var message = `return confirm('Are you sure you want to Remove the InternalTransfer Information ?')`;

                                    var buttons = '<span data-toggle="tooltip" title="Report"> <a href=\"' + myUrlReport + '\"  class=\"btn btn-icon btn-success btn-sm rounded-0 m-b-5\" target=\"_blank\"><i class="bi bi-printer"></i></a></span>';
                                    if (!data.isPosted) {
                                        if (data.isPOSInternalTransfer) {
                                            buttons += '<span data-toggle="tooltip" title="POS Edit"> <a href=\"' + myUrlposedit + '\" class=\"btn btn-icon btn-info btn-sm rounded-0 rounded-0 m-b-5\" target=\"_blank\"><i class="bi bi-pencil-square"></i></a></span>';
                                        }
                                        //else if (data.isSerialInternalTransfer) {
                                        //    buttons += '<span data-toggle="tooltip" title="Barcode Scan InternalTransfer Edit"> <a href=\"' + myUrlSerialInternalTransferedit + '\" class=\"btn btn-icon btn-default btn-sm rounded-0 rounded-0 m-b-5\" target=\"_blank\"><i class="bi bi-pencil-square"></i></a></span>';
                                        //}
                                        else {
                                            buttons += '<span data-toggle="tooltip" title="Edit"> <a href=\"' + myUrledit + '\" class=\"btn btn-icon btn-warning btn-sm rounded-0 m-b-5\" target=\"_blank\"><i class="bi bi-pencil-square"></i></a></span>';
                                        }
                                        buttons += '<span data-toggle="tooltip" title="Delete"> <a href=\"' + myUrldelete + '\"  onclick = \"' + message + '\"  class=\"btn btn-icon btn-danger btn-sm rounded-0 m-b-5\" target=\"_self\"><i class="bi bi-x"></i></a></span>';
                                    }
                                    else
                                    {
                                       // buttons += '<span data-toggle="tooltip" title="View"> <a href=\"' + myUrlView + '\" class=\"fa fa-eye text-info px-1 h4\" target=\"_blank\"></a></span>';
                                    }
                                    return buttons;
                                }

                            }
                        ],
                //"order": [0, "desc"],
                "processing": true,
                "language": {
                    sLengthMenu: " _MENU_",
                    search: "",
                    searchPlaceholder: "Search..."
                },
                "destroy": true
            });
        }

    });



    </script>




}










