@{ ViewData["Title"] = "Ecommerce";
    Layout = "~/Views/Shared/_EcommerceLayout.cshtml"; }

<style>

    /* Please see documentation at https://docs.microsoft.com/aspnet/core/client-side/bundling-and-minification
    for details on configuring this project to bundle and minify static web assets. */

    a.navbar-brand {
        white-space: normal;
        text-align: center;
        word-break: break-all;
    }

    /* Provide sufficient contrast against white background */
    a {
        color: #0366d6;
    }

    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }

    .nav-pills .nav-link.active, .nav-pills .show > .nav-link {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }

    /* Sticky footer styles
    -------------------------------------------------- */
    html {
        font-size: 14px;
    }

    @@media (min-width: 768px) {
        html {
            font-size: 16px;
        }
    }

    .border-top {
        border-top: 1px solid #e5e5e5;
    }

    .border-bottom {
        border-bottom: 1px solid #e5e5e5;
    }

    .box-shadow {
        box-shadow: 0 .25rem .75rem rgba(0, 0, 0, .05);
    }

    button.accept-policy {
        font-size: 1rem;
        line-height: inherit;
    }

    /* Sticky footer styles
    -------------------------------------------------- */
    html {
        position: relative;
        min-height: 100%;
    }

    body {
        /* Margin bottom by footer height */
        margin-bottom: 30px;
        margin-top: 30px;
    }

    .footer {
        position: absolute;
        bottom: 0;
        width: 100%;
        white-space: nowrap;
        line-height: 60px; /* Vertically center the text there */
    }

    .cards tbody tr {
        width: 164px;
        border: 1px solid #D3D3D3;
        text-align: center;
        transition: transform .2s;
        justify-content: center;
        align-items: center;
        display: inline-block;
        margin: 3px 3px;
    }

    /*    .cards tbody tr {
        width: 170px;
        border: 1px solid #D3D3D3;
        text-align: center;
        transition: transform .2s;
        justify-content: center;
        align-items: center;
        display: inline-block;
        margin: 5px 10px;
    }*/

    .cards tbody td {
        display: block;
    }

    .fa-star {
        color: #F8C53C;
    }




    .cards thead {
        display: none;
    }



    .cards td:before {
        content: attr(data-label);
        position: relative;
        float: left;
        color: #808080;
        min-width: 4rem;
        margin-left: 0;
        margin-right: 1rem;
        text-align: left;
    }

    tr.selected td:before {
        color: #CCC;
    }
    /*
    .tbl .avatar {
        width: 50px;
    }*/

    .cards .avatar {
        /*        width: 165px;
        height: 170px;*/
        height: 170px;
        width: 100%;
    }

    .product-description {
        font-size: 14px;
        min-height: 38px;
        overflow: hidden;
    }

        .product-description:hover {
            color: #79C9EB;
        }

    .cards tbody tr:hover {
        border-radius: 0px;
        box-shadow: 3px 3px 4px #ededed, -3px -3px 4px #ededed;
        transition: ease-in-out .2s;
        transform: translateY(2px);
    }

    .cards .avatar:hover {
        transform: translateY(2px);
        transition: ease-in-out .2s;
    }

    .product-price {
        color: #F47E6D;
        font-weight: bold;
        margin-bottom: 8px;
        font-size: 16px;
    }

    .old-price {
        margin-left: 2px;
    }

    .money {
        font-size: 16px;
        font-weight: bold;
        /*font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;*/
    }
</style>
<div class="container pt-5">
    <div class="row">
        <div class="col-md-8 order-md-2 col-lg-9">
            <div class="container-fluid">
                <div class="row   mb-5">
                    <div class="col-12">
                        <div class="dropdown text-md-left text-center float-md-left mb-3 mt-3 mt-md-0 mb-md-0">
                            <label class="mr-2">Sort by:</label>
                            @*<a class="btn btn-lg btn-light dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Relevance <span class="caret"></span></a>*@
                            @Html.DropDownList("Sorting", ViewBag.Sorting as List<SelectListItem>, new { id = "Sorting", @class = "form-control" })

                            @*<div class="dropdown-menu" aria-labelledby="navbarDropdown" x-placement="bottom-start" style="position: absolute; transform: translate3d(71px, 48px, 0px); top: 0px; left: 0px; will-change: transform;">

                                <a class="dropdown-item" href="#">Relevance</a>
            <a class="dropdown-item" href="#">Price Descending</a>
            <a class="dropdown-item" href="#">Price Ascending</a>
            <a class="dropdown-item" href="#">Best Selling</a>
                            </div>*@
                        </div>
                        <div class="btn-group float-md-right ml-3">
                            <button type="button" class="btn btn-lg btn-light"> <span class="fa fa-arrow-left"></span> </button>
                            <button type="button" class="btn btn-lg btn-light"> <span class="fa fa-arrow-right"></span> </button>
                        </div>
                        <div class="dropdown float-right">
                            <label class="mr-2">View:</label>
                            <a class="btn btn-lg btn-light dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">9 <span class="caret"></span></a>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown" x-placement="bottom-end" style="will-change: transform; position: absolute; transform: translate3d(120px, 48px, 0px); top: 0px; left: 0px;">
                                <a class="dropdown-item" href="#">12</a>
                                <a class="dropdown-item" href="#">24</a>
                                <a class="dropdown-item" href="#">48</a>
                                <a class="dropdown-item" href="#">96</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-md-12">
                        <table class="tbl cards table-sm no-footer text-center dataTable" cellspacing="0" width="100%" id="tblProductSearc">
                        </table>
                    </div>
                </div>

                <div class="row sorting mb-5 mt-5">
                    <div class="col-12">
                        <a class="btn btn-light">
                            <i class="fas fa-arrow-up mr-2"></i> Back to top
                        </a>
                        <div class="btn-group float-md-right ml-3">
                            <button type="button" class="btn btn-lg btn-light"> <span class="fa fa-arrow-left"></span> </button>
                            <button type="button" class="btn btn-lg btn-light"> <span class="fa fa-arrow-right"></span> </button>
                        </div>
                        <div class="dropdown float-md-right">
                            <label class="mr-2">View:</label>
                            <a class="btn btn-light btn-lg dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">12 <span class="caret"></span></a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" href="#">12</a>
                                <a class="dropdown-item" href="#">24</a>
                                <a class="dropdown-item" href="#">48</a>
                                <a class="dropdown-item" href="#">96</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div><div class="col-md-4 order-md-1 col-lg-3 sidebar-filter">
    <h3 class="mt-0 mb-5">Showing <span class="text-primary">12</span> Products</h3>
    <h6 class="text-uppercase font-weight-bold mb-3">Categories</h6>

    @foreach (var item in ViewBag.Category)
    {
<div class="mt-2 mb-2 pl-2">
    <div class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" id=@item.Value>
        <label class="custom-control-label" for=@item.Value>@item.Text</label>
    </div>
</div>      }




    <div class="divider mt-5 mb-5 border-bottom border-secondary"></div>
    <h6 class="text-uppercase mt-5 mb-3 font-weight-bold">Size</h6>
    @foreach (var item in ViewBag.Size)
    {
        <div class="mt-2 mb-2 pl-2">
            <div class="custom-control custom-checkbox">
                <input type="checkbox" class="custom-control-input" id=@item.Value>
                <label class="custom-control-label" for=@item.Value>@item.Value</label>
            </div>
        </div>

    }
    @*<div class="mt-2 mb-2 pl-2">
        <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="filter-size-1">
            <label class="custom-control-label" for="filter-size-1">X-Small</label>
        </div>
    </div>
    <div class="mt-2 mb-2 pl-2">
        <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="filter-size-2">
            <label class="custom-control-label" for="filter-size-2">Small</label>
        </div>
    </div>
    <div class="mt-2 mb-2 pl-2">
        <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="filter-size-3">
            <label class="custom-control-label" for="filter-size-3">Medium</label>
        </div>
    </div>
    <div class="mt-2 mb-2 pl-2">
        <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="filter-size-4">
            <label class="custom-control-label" for="filter-size-4">Large</label>
        </div>
    </div>
    <div class="mt-2 mb-2 pl-2">
        <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="filter-size-5">
            <label class="custom-control-label" for="filter-size-5">X-Large</label>
        </div>
    </div>*@
    <div class="divider mt-5 mb-5 border-bottom border-secondary"></div>
    <h6 class="text-uppercase mt-5 mb-3 font-weight-bold">Price</h6>
    <div class="price-filter-control">
        <input type="number" class="form-control w-50 pull-left mb-2" value="50" id="price-min-control">
        <input type="number" class="form-control w-50 pull-right" value="150" id="price-max-control">
    </div>
    <input id="ex2" type="text" class="slider " value="50,150" data-slider-min="10" data-slider-max="200" data-slider-step="5" data-slider-value="[50,150]" data-value="50,150" style="display: none;">
    <div class="divider mt-5 mb-5 border-bottom border-secondary"></div>
    <a href="#" class="btn btn-lg btn-block btn-primary mt-5">Update Results</a>
</div>

    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        var tblProductSearc;
        $(document).ready(function () {
                function myFunction() {
                    $('#myInput').keyup(function () {
                        tblProductSearc.search($(this).val()).draw();
                    })
                }


                CategorySearch(0);
                //$('.dataTables_wrapper').addClass('col-md-12'); // <-- add this line

                $("#Category").change(function () {
                    tblProductSearc.destroy();

                    CategorySearch(0);//$('#Category').val()
                });




                function CategorySearch(CategoryId) {

                    //alert(CategoryId);
                    ///var oTable = $('#tblProductSearc').DataTable();   //pay attention to capital D, which is mandatory to retrieve "api" datatables' object, as //Lionel said

                    //var CategoryId = $("#categorygrid tbody tr.selected td:nth-child(2)").text();

                    tblProductSearc = $('#tblProductSearc').DataTable({
                        serverSide: true,  "scrollX": true,
                        //processing: true,

                        //"bInfo" : false,
                        //searchDelay: 1,
                        ajax: {
                            url: '@Url.Action("GetProductListClick", "Home")',
                            "data": { CategoryId: CategoryId },

                            type: "POST"
                        },
                        columns: [
                            //{ "title": "ProductId", "data": "ProductId", "visible": false, "searchable": false },
                            {
                                "title": "Image", "data": "ImagePath", "searchable": false,
                                "render": function (data) {
                                    return '<img src="..' + data + '" class="avatar" onerror=this.onerror=null;this.src="../Content/ProductImages/0.png">';
                                }
                            },
                            {
                                "data": "Rating",
                                "render": function (data, type, row) {
                                    return '<span class="fa fa-star checked"></span>' +
                                        '<span class="fa fa-star checked"></span>' +
                                        '<span class="fa fa-star checked"></span>';

                                }
                            },
                            {
                                "title": "Product", "data": "ProductName", "searchable": true, "render": function (data) {
                                    var res = data.toString().replace(".", " ").substring(0, 17).toString();
                                    var finaltext = res;//pad(res, 17);
                                    return '<div class="product-description"> ' + finaltext + '</div>';
                                }
                            },
                            {
                                "data": {
                                    Id: "Id" //,
                                },
                                "render": function (data, type, row) {
                                    var showdata = '';

                                    if (data.OldPrice > 0) {
                                        showdata=   '  <div class="product-price">  <span class="money">৳</span>' + data.SalesPrice + ' <span class="old-price"><del class="money">৳ ' + data.OldPrice + '</del></span> </div> ';
                                    }
                                    else {
                                        showdata =  '  <div class="product-price">  <span class="money">৳</span>' + data.SalesPrice + ' <span class="old-price"></span> </div> ';
                                    }
                                    return  showdata ;
                                }
                            },
                            {
                                "title": "Action",
                                "data": {
                                    Id: "Id" //,
                                },
                                "render": function (data, type, row) {
                                    var myurldetails = '@Url.Action("ProductDetails", "home")?ProductId=' + data.ProductId;
                                    var content = '<span data-toggle="tooltip" title="Details"> <a href=\"' + myurldetails + '\" class=\"btn btn-sm btn-dark rounded-0\" target=\"_self\">Details</a></span>';
                                    content += '<a href="#" data-id="' + data.ProductId + '" data-name="' + data.ProductName + '" data-price=' + data.SalesPrice +' class="btn btn-sm btn-success rounded-0 add-to-cart">Add to cart </a>';
                                    return content;
                                }
                            }
                        ],
                        "paging": true,
                        "ordering": false,
                        "bSortable": false ,
                        "iDisplayLength": 8,
                        "lengthMenu": [[4, 8, 10, 12, 25, 50, -1], [4, 8, 10, 12, 25, 50, "All"]],
                        "bLengthChange": false, //thought this line could hide the LengthMenu
                        "bInfo": false,
                        "dom": '<"top"<"row"<"col"><"col"f><"col">>>rt<"bottom"<"row"<"col"><"col"p><"col">>><"clear">'
                    });
                }


            $('#tblProductSearc tbody').on('click', '.add-to-cart', function () {
                var table = $('#tblProductSearc').DataTable();

                var data = table.row($(this).parents('tr')).data();

                shoppingCart.addItemToCart(data.ProductId, data.ProductName, data.SalesPrice, 1);
                displayCart();


                $('html, body').animate({
                    'scrollTop': $(".cart_anchor").position().top
                });

                var itemImg = $(this).parent('td').parent('tr').find('img').eq(0);
                flyToElement($(itemImg), $('.cart_anchor'));

            });
            });


    </script>
}